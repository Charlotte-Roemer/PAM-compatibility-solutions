# # interaction with distance to vegetation as a quadratic effect :
glm3 = glmmTMB(nb_triggered_files ~ Distance_vegetation * ID +
I(Distance_vegetation^2) * ID +
(1|Site),
data=Activity_file_for_model, family = nbinom2)
# interaction with insect activity:
glm4 = glmmTMB(nb_triggered_files ~ sqrt(sm4bat_0_noise_insect_bat_activity) * ID +
(1|Site),
data=Activity_file_for_model, family = nbinom2)
glm4.1 = glmmTMB(nb_triggered_files ~ sm4bat_0_noise_insect_bat_activity * ID +
(1|Site),
data=Activity_file_for_model, family = nbinom2)
# interaction with distance to vegetation + interaction with insect activity:
glm5 = glmmTMB(nb_triggered_files ~ sqrt(sm4bat_0_noise_insect_bat_activity) * ID + Distance_vegetation * ID +
(1|Site),
data=Activity_file_for_model, family = nbinom2)
# simulateResiduals(glm1, plot = TRUE)
# simulateResiduals(glm2, plot = TRUE)
# simulateResiduals(glm3, plot = TRUE)
# simulateResiduals(glm4, plot = TRUE)
# # Model comparison :
AIC_Table = AIC(glm1,glm2,glm3, glm4, glm5)
AIC_Table$Species = Sp_select
# Save
write_csv(AIC_Table, paste0("/home/charlotte/Documents/Post-Doc/Stages/Laureen et Nathan/Analyse/Effet environnement/5_seconds/", Sp_select,"_AIC.csv"))
Sp_select = "Plesp"
Proba = 0.5
Time_interval = "5_seconds" # "5_seconds", "minute", "5_minutes", "10_minutes", "hour"
Activity_file <- read_delim(paste0("/home/charlotte/Documents/Post-Doc/Stages/Laureen et Nathan/Analyse/Activity_file_",
str_replace(Time_interval, " ", "_"), ".csv"))
Non_target_activity_file = read_delim("/home/charlotte/Documents/Post-Doc/Stages/Laureen et Nathan/Analyse/Activity_file_non-target_0s.csv")
# Display most common species
Activity_file %>%
filter(Recorder == "SM4BAT", probability_filter == Proba) %>%
group_by(espece) %>%
summarise(n=sum(nb_triggered_files)) %>%
as.data.frame() %>%
arrange(n)
# Merge all Plecotus rows
Activity_file = Activity_file %>%
mutate(espece = ifelse((espece == "Pleaur" | espece== "Pleaus" | espece== "Plemac"), "Plesp", espece)) %>%
group_by(across(-nb_triggered_files)) %>%
summarise(nb_triggered_files = sum(nb_triggered_files), .groups = "drop")
# # Remove false result
# Activity_file = Activity_file %>%
#   filter(!(Site=="B1" & TriggerLevel == 5))
# Consider Batlogger A and Batlogger A+ the same machine
Activity_file$Recorder = gsub("^Batlogger.*", "Batlogger", Activity_file$Recorder)
# Add ID for Recorder + Sensitivity Level
Activity_file$ID = paste0(Activity_file$Recorder, "_", Activity_file$TriggerLevel)
# Remove Site CE_0 because it is another design
Activity_file = Activity_file %>%
filter(Site != "CE_0")
# Adapt Trigger Level so that it goes in the right direction
Activity_file$TriggerLevel_adjusted = Activity_file$TriggerLevel
Activity_file$TriggerLevel_adjusted = ifelse(Activity_file$Recorder!="Audiomoth",-Activity_file$TriggerLevel, Activity_file$TriggerLevel_adjusted)
Activity_file$TriggerLevel_adjusted = ifelse(Activity_file$Recorder=="Audiomoth" & Activity_file$TriggerLevel==0, 100, Activity_file$TriggerLevel_adjusted)
Activity_file$TriggerLevel_adjusted = ifelse(Activity_file$Recorder=="Audiomoth" & Activity_file$TriggerLevel==5, 26, Activity_file$TriggerLevel_adjusted)
# Create short names
Activity_file$TriggerLevel_Short = Activity_file$TriggerLevel_adjusted
Activity_file$TriggerLevel_Short = ifelse(Activity_file$TriggerLevel_adjusted==0, "High", Activity_file$TriggerLevel_Short)
Activity_file$TriggerLevel_Short = ifelse(Activity_file$TriggerLevel_adjusted==-24, "Low", Activity_file$TriggerLevel_Short)
Activity_file$TriggerLevel_Short = ifelse(Activity_file$TriggerLevel_adjusted==-10, "Low", Activity_file$TriggerLevel_Short)
Activity_file$TriggerLevel_Short = ifelse(Activity_file$TriggerLevel_adjusted==26, "Low", Activity_file$TriggerLevel_Short)
Activity_file$TriggerLevel_Short = ifelse(Activity_file$TriggerLevel_adjusted==27, "Medium", Activity_file$TriggerLevel_Short)
Activity_file$TriggerLevel_Short = ifelse(Activity_file$TriggerLevel_adjusted==100, "High", Activity_file$TriggerLevel_Short)
# Add ID for Recorder + Sensitivity Level
Activity_file$ID = paste0(Activity_file$Recorder, "_", Activity_file$TriggerLevel_Short)
# Calculate insect and noise and other bat activity
List_bats_0s = c("Barbar", "Eptnil", "Eptser", "Hypsav", "Minsch", "Myoalc", "Myobec", "Myobly",
"Myobra", "Myocap", "Myodas", "Myodau", "Myoema", "MyoGT", "Myomyo", "Myomys",
"Myonat", "Myopun", "MyospA", "Nyclas", "Nyclei", "Nycnoc", "Pipkuh", "Pipnat",
"Pippip", "Pippyg", "Pleaur", "Pleaus", "Plemac", "Rhieur", "Rhifer", "Rhihip",
"Tadten", "Vesmur")
List_bats_0s = List_bats_0s[! List_bats_0s %in% Sp_select] # Removes focus species
List_bats_0s = paste0(List_bats_0s, "_0s")
Activity_non_target = Non_target_activity_file %>%
filter(probability_filter == Proba) %>%
group_by(DateNight, idparticipation) %>%
summarise(nb_triggered_files_insects = sum(nb_triggered_files[espece == "Insect_0s"]),
nb_triggered_files_noise = sum(nb_triggered_files[espece == "Noise_0s"]),
nb_triggered_files_bats = sum(nb_triggered_files[espece %in% List_bats_0s]))
# Calculate Relative activity to make results comparable
# Select species and keep only 0.5 confidence
Activity_file_for_model <- Activity_file %>%
filter(espece == Sp_select, probability_filter == Proba) %>%
group_by(DateNight) %>%
mutate(sm4bat_0_activity = nb_triggered_files[ID == "SM4BAT_High"]) %>%
mutate(Relative_activity = nb_triggered_files / sm4bat_0_activity) %>%
mutate(Relative_activity = ifelse(sm4bat_0_activity==0, NA, Relative_activity)) %>% #if SM4BAT_0 did not pick the species, then the species is considered absent on the site
ungroup() %>%
as.data.frame()
# Confirm this decision with Christian!!!
# Put Relative activity at 1 even if it is above 1
Activity_file_for_model$Relative_activity = ifelse(Activity_file_for_model$Relative_activity>1,
1,
Activity_file_for_model$Relative_activity)
# Add insect + noise + bat activity
Activity_file_for_model = Activity_file_for_model %>%
left_join(Activity_non_target) %>%
group_by(DateNight) %>%
mutate(sm4bat_0_insect_activity = nb_triggered_files_insects[ID == "SM4BAT_High"],
sm4bat_0_noise_and_insect_activity = nb_triggered_files_insects[ID == "SM4BAT_High"] + nb_triggered_files_noise[ID == "SM4BAT_High"],
sm4bat_0_noise_insect_bat_activity = nb_triggered_files_insects[ID == "SM4BAT_High"] + nb_triggered_files_noise[ID == "SM4BAT_High"] + nb_triggered_files_bats[ID == "SM4BAT_High"]) %>%
ungroup() %>%
as.data.frame()
Activity_file_for_model$Recorder = as.factor(Activity_file_for_model$Recorder)
Activity_file_for_model$ID = as.factor(Activity_file_for_model$ID)
Activity_file_for_model$TriggerLevel_adjusted = as.factor(Activity_file_for_model$TriggerLevel_adjusted)
#mycol <- c("Audiomoth"= "#E69F00","Batcorder"="#56B4E9","Batlogger"="#009E73","SM4BAT"="#D55E00")
# #### DATA VISUALISATION ####
#
# setwd("/home/charlotte/Documents/Post-Doc/Stages/Laureen et Nathan/Analyse/Exploration")
# png(filename=paste(Sp_select,"_", "Material",sep=""), height=700, width=1000,res=150)
#
# plot1 = ggplot(Activity_file_for_model, aes(x = Recorder, y = nb_triggered_files)) +
#   geom_boxplot(aes(fill = TriggerLevel_Short), color = "grey25", linewidth = 0.5, coef = 1.5) +
#   theme_minimal()
#
# print(plot1)
# dev.off()
#
# png(filename=paste(Sp_select,"_", "Material_and_Vegetation.png",sep=""), height=700, width=1000,res=150)
#
# plot2 = ggplot(Activity_file_for_model, aes(x = Distance_vegetation, y = nb_triggered_files, group=ID)) +
#   geom_rug() +
#   geom_smooth(aes(color = ID)) +
#   theme_minimal()
#
# print(plot2)
# dev.off()
#
# png(filename=paste(Sp_select,"_", "Material_and_non-target.png",sep=""), height=700, width=1000,res=150)
#
# plot3 = ggplot(Activity_file_for_model, aes(x = sm4bat_0_noise_insect_bat_activity, y = nb_triggered_files, group=ID)) +
#   geom_rug() +
#   geom_smooth(aes(color = ID)) +
#   theme_minimal()
#
# print(plot3)
# dev.off()
#### MODEL ENVIRONMENT EFFECT ####
# Question: how to account for the distance to vegetation (DV), and for the insect/noise activity (IA)?
# i.e. is there an interaction between recorder sensitivity and DV or IA?
# # Comment to keep the Audiomoths
# Activity_file_for_model = Activity_file_for_model %>%
#   filter(Recorder != "Audiomoth") %>%
#   droplevels()
# Activity
# NULL Model
glm1 <- glmmTMB(nb_triggered_files~ID +
(1|Site),
data = Activity_file_for_model, family = nbinom2)
# interaction with distance to vegetation:
glm2 = glmmTMB(nb_triggered_files ~ Distance_vegetation * ID +
(1|Site),
data=Activity_file_for_model, family = nbinom2)
# # interaction with distance to vegetation as a quadratic effect :
glm3 = glmmTMB(nb_triggered_files ~ Distance_vegetation * ID +
I(Distance_vegetation^2) * ID +
(1|Site),
data=Activity_file_for_model, family = nbinom2)
# interaction with insect activity:
glm4 = glmmTMB(nb_triggered_files ~ sqrt(sm4bat_0_noise_insect_bat_activity) * ID +
(1|Site),
data=Activity_file_for_model, family = nbinom2)
glm4.1 = glmmTMB(nb_triggered_files ~ sm4bat_0_noise_insect_bat_activity * ID +
(1|Site),
data=Activity_file_for_model, family = nbinom2)
# interaction with distance to vegetation + interaction with insect activity:
glm5 = glmmTMB(nb_triggered_files ~ sqrt(sm4bat_0_noise_insect_bat_activity) * ID + Distance_vegetation * ID +
(1|Site),
data=Activity_file_for_model, family = nbinom2)
# simulateResiduals(glm1, plot = TRUE)
# simulateResiduals(glm2, plot = TRUE)
# simulateResiduals(glm3, plot = TRUE)
# simulateResiduals(glm4, plot = TRUE)
# # Model comparison :
AIC_Table = AIC(glm1,glm2,glm3, glm4, glm5)
AIC_Table$Species = Sp_select
# Save
write_csv(AIC_Table, paste0("/home/charlotte/Documents/Post-Doc/Stages/Laureen et Nathan/Analyse/Effet environnement/5_seconds/", Sp_select,"_AIC.csv"))
Sp_select = "Rhihip"
Proba = 0.5
Time_interval = "5_seconds" # "5_seconds", "minute", "5_minutes", "10_minutes", "hour"
Activity_file <- read_delim(paste0("/home/charlotte/Documents/Post-Doc/Stages/Laureen et Nathan/Analyse/Activity_file_",
str_replace(Time_interval, " ", "_"), ".csv"))
Non_target_activity_file = read_delim("/home/charlotte/Documents/Post-Doc/Stages/Laureen et Nathan/Analyse/Activity_file_non-target_0s.csv")
# Display most common species
Activity_file %>%
filter(Recorder == "SM4BAT", probability_filter == Proba) %>%
group_by(espece) %>%
summarise(n=sum(nb_triggered_files)) %>%
as.data.frame() %>%
arrange(n)
# Merge all Plecotus rows
Activity_file = Activity_file %>%
mutate(espece = ifelse((espece == "Pleaur" | espece== "Pleaus" | espece== "Plemac"), "Plesp", espece)) %>%
group_by(across(-nb_triggered_files)) %>%
summarise(nb_triggered_files = sum(nb_triggered_files), .groups = "drop")
# # Remove false result
# Activity_file = Activity_file %>%
#   filter(!(Site=="B1" & TriggerLevel == 5))
# Consider Batlogger A and Batlogger A+ the same machine
Activity_file$Recorder = gsub("^Batlogger.*", "Batlogger", Activity_file$Recorder)
# Add ID for Recorder + Sensitivity Level
Activity_file$ID = paste0(Activity_file$Recorder, "_", Activity_file$TriggerLevel)
# Remove Site CE_0 because it is another design
Activity_file = Activity_file %>%
filter(Site != "CE_0")
# Adapt Trigger Level so that it goes in the right direction
Activity_file$TriggerLevel_adjusted = Activity_file$TriggerLevel
Activity_file$TriggerLevel_adjusted = ifelse(Activity_file$Recorder!="Audiomoth",-Activity_file$TriggerLevel, Activity_file$TriggerLevel_adjusted)
Activity_file$TriggerLevel_adjusted = ifelse(Activity_file$Recorder=="Audiomoth" & Activity_file$TriggerLevel==0, 100, Activity_file$TriggerLevel_adjusted)
Activity_file$TriggerLevel_adjusted = ifelse(Activity_file$Recorder=="Audiomoth" & Activity_file$TriggerLevel==5, 26, Activity_file$TriggerLevel_adjusted)
# Create short names
Activity_file$TriggerLevel_Short = Activity_file$TriggerLevel_adjusted
Activity_file$TriggerLevel_Short = ifelse(Activity_file$TriggerLevel_adjusted==0, "High", Activity_file$TriggerLevel_Short)
Activity_file$TriggerLevel_Short = ifelse(Activity_file$TriggerLevel_adjusted==-24, "Low", Activity_file$TriggerLevel_Short)
Activity_file$TriggerLevel_Short = ifelse(Activity_file$TriggerLevel_adjusted==-10, "Low", Activity_file$TriggerLevel_Short)
Activity_file$TriggerLevel_Short = ifelse(Activity_file$TriggerLevel_adjusted==26, "Low", Activity_file$TriggerLevel_Short)
Activity_file$TriggerLevel_Short = ifelse(Activity_file$TriggerLevel_adjusted==27, "Medium", Activity_file$TriggerLevel_Short)
Activity_file$TriggerLevel_Short = ifelse(Activity_file$TriggerLevel_adjusted==100, "High", Activity_file$TriggerLevel_Short)
# Add ID for Recorder + Sensitivity Level
Activity_file$ID = paste0(Activity_file$Recorder, "_", Activity_file$TriggerLevel_Short)
# Calculate insect and noise and other bat activity
List_bats_0s = c("Barbar", "Eptnil", "Eptser", "Hypsav", "Minsch", "Myoalc", "Myobec", "Myobly",
"Myobra", "Myocap", "Myodas", "Myodau", "Myoema", "MyoGT", "Myomyo", "Myomys",
"Myonat", "Myopun", "MyospA", "Nyclas", "Nyclei", "Nycnoc", "Pipkuh", "Pipnat",
"Pippip", "Pippyg", "Pleaur", "Pleaus", "Plemac", "Rhieur", "Rhifer", "Rhihip",
"Tadten", "Vesmur")
List_bats_0s = List_bats_0s[! List_bats_0s %in% Sp_select] # Removes focus species
List_bats_0s = paste0(List_bats_0s, "_0s")
Activity_non_target = Non_target_activity_file %>%
filter(probability_filter == Proba) %>%
group_by(DateNight, idparticipation) %>%
summarise(nb_triggered_files_insects = sum(nb_triggered_files[espece == "Insect_0s"]),
nb_triggered_files_noise = sum(nb_triggered_files[espece == "Noise_0s"]),
nb_triggered_files_bats = sum(nb_triggered_files[espece %in% List_bats_0s]))
# Calculate Relative activity to make results comparable
# Select species and keep only 0.5 confidence
Activity_file_for_model <- Activity_file %>%
filter(espece == Sp_select, probability_filter == Proba) %>%
group_by(DateNight) %>%
mutate(sm4bat_0_activity = nb_triggered_files[ID == "SM4BAT_High"]) %>%
mutate(Relative_activity = nb_triggered_files / sm4bat_0_activity) %>%
mutate(Relative_activity = ifelse(sm4bat_0_activity==0, NA, Relative_activity)) %>% #if SM4BAT_0 did not pick the species, then the species is considered absent on the site
ungroup() %>%
as.data.frame()
# Confirm this decision with Christian!!!
# Put Relative activity at 1 even if it is above 1
Activity_file_for_model$Relative_activity = ifelse(Activity_file_for_model$Relative_activity>1,
1,
Activity_file_for_model$Relative_activity)
# Add insect + noise + bat activity
Activity_file_for_model = Activity_file_for_model %>%
left_join(Activity_non_target) %>%
group_by(DateNight) %>%
mutate(sm4bat_0_insect_activity = nb_triggered_files_insects[ID == "SM4BAT_High"],
sm4bat_0_noise_and_insect_activity = nb_triggered_files_insects[ID == "SM4BAT_High"] + nb_triggered_files_noise[ID == "SM4BAT_High"],
sm4bat_0_noise_insect_bat_activity = nb_triggered_files_insects[ID == "SM4BAT_High"] + nb_triggered_files_noise[ID == "SM4BAT_High"] + nb_triggered_files_bats[ID == "SM4BAT_High"]) %>%
ungroup() %>%
as.data.frame()
Activity_file_for_model$Recorder = as.factor(Activity_file_for_model$Recorder)
Activity_file_for_model$ID = as.factor(Activity_file_for_model$ID)
Activity_file_for_model$TriggerLevel_adjusted = as.factor(Activity_file_for_model$TriggerLevel_adjusted)
#mycol <- c("Audiomoth"= "#E69F00","Batcorder"="#56B4E9","Batlogger"="#009E73","SM4BAT"="#D55E00")
# #### DATA VISUALISATION ####
#
# setwd("/home/charlotte/Documents/Post-Doc/Stages/Laureen et Nathan/Analyse/Exploration")
# png(filename=paste(Sp_select,"_", "Material",sep=""), height=700, width=1000,res=150)
#
# plot1 = ggplot(Activity_file_for_model, aes(x = Recorder, y = nb_triggered_files)) +
#   geom_boxplot(aes(fill = TriggerLevel_Short), color = "grey25", linewidth = 0.5, coef = 1.5) +
#   theme_minimal()
#
# print(plot1)
# dev.off()
#
# png(filename=paste(Sp_select,"_", "Material_and_Vegetation.png",sep=""), height=700, width=1000,res=150)
#
# plot2 = ggplot(Activity_file_for_model, aes(x = Distance_vegetation, y = nb_triggered_files, group=ID)) +
#   geom_rug() +
#   geom_smooth(aes(color = ID)) +
#   theme_minimal()
#
# print(plot2)
# dev.off()
#
# png(filename=paste(Sp_select,"_", "Material_and_non-target.png",sep=""), height=700, width=1000,res=150)
#
# plot3 = ggplot(Activity_file_for_model, aes(x = sm4bat_0_noise_insect_bat_activity, y = nb_triggered_files, group=ID)) +
#   geom_rug() +
#   geom_smooth(aes(color = ID)) +
#   theme_minimal()
#
# print(plot3)
# dev.off()
#### MODEL ENVIRONMENT EFFECT ####
# Question: how to account for the distance to vegetation (DV), and for the insect/noise activity (IA)?
# i.e. is there an interaction between recorder sensitivity and DV or IA?
# # Comment to keep the Audiomoths
# Activity_file_for_model = Activity_file_for_model %>%
#   filter(Recorder != "Audiomoth") %>%
#   droplevels()
# Activity
# NULL Model
glm1 <- glmmTMB(nb_triggered_files~ID +
(1|Site),
data = Activity_file_for_model, family = nbinom2)
# interaction with distance to vegetation:
glm2 = glmmTMB(nb_triggered_files ~ Distance_vegetation * ID +
(1|Site),
data=Activity_file_for_model, family = nbinom2)
# # interaction with distance to vegetation as a quadratic effect :
glm3 = glmmTMB(nb_triggered_files ~ Distance_vegetation * ID +
I(Distance_vegetation^2) * ID +
(1|Site),
data=Activity_file_for_model, family = nbinom2)
# interaction with insect activity:
glm4 = glmmTMB(nb_triggered_files ~ sqrt(sm4bat_0_noise_insect_bat_activity) * ID +
(1|Site),
data=Activity_file_for_model, family = nbinom2)
glm4.1 = glmmTMB(nb_triggered_files ~ sm4bat_0_noise_insect_bat_activity * ID +
(1|Site),
data=Activity_file_for_model, family = nbinom2)
# interaction with distance to vegetation + interaction with insect activity:
glm5 = glmmTMB(nb_triggered_files ~ sqrt(sm4bat_0_noise_insect_bat_activity) * ID + Distance_vegetation * ID +
(1|Site),
data=Activity_file_for_model, family = nbinom2)
# simulateResiduals(glm1, plot = TRUE)
# simulateResiduals(glm2, plot = TRUE)
# simulateResiduals(glm3, plot = TRUE)
# simulateResiduals(glm4, plot = TRUE)
# # Model comparison :
AIC_Table = AIC(glm1,glm2,glm3, glm4, glm5)
AIC_Table$Species = Sp_select
# Save
write_csv(AIC_Table, paste0("/home/charlotte/Documents/Post-Doc/Stages/Laureen et Nathan/Analyse/Effet environnement/5_seconds/", Sp_select,"_AIC.csv"))
Sp_select = "Pippyg"
Proba = 0.5
Time_interval = "5_seconds" # "5_seconds", "minute", "5_minutes", "10_minutes", "hour"
Activity_file <- read_delim(paste0("/home/charlotte/Documents/Post-Doc/Stages/Laureen et Nathan/Analyse/Activity_file_",
str_replace(Time_interval, " ", "_"), ".csv"))
Non_target_activity_file = read_delim("/home/charlotte/Documents/Post-Doc/Stages/Laureen et Nathan/Analyse/Activity_file_non-target_0s.csv")
# Display most common species
Activity_file %>%
filter(Recorder == "SM4BAT", probability_filter == Proba) %>%
group_by(espece) %>%
summarise(n=sum(nb_triggered_files)) %>%
as.data.frame() %>%
arrange(n)
# Merge all Plecotus rows
Activity_file = Activity_file %>%
mutate(espece = ifelse((espece == "Pleaur" | espece== "Pleaus" | espece== "Plemac"), "Plesp", espece)) %>%
group_by(across(-nb_triggered_files)) %>%
summarise(nb_triggered_files = sum(nb_triggered_files), .groups = "drop")
# # Remove false result
# Activity_file = Activity_file %>%
#   filter(!(Site=="B1" & TriggerLevel == 5))
# Consider Batlogger A and Batlogger A+ the same machine
Activity_file$Recorder = gsub("^Batlogger.*", "Batlogger", Activity_file$Recorder)
# Add ID for Recorder + Sensitivity Level
Activity_file$ID = paste0(Activity_file$Recorder, "_", Activity_file$TriggerLevel)
# Remove Site CE_0 because it is another design
Activity_file = Activity_file %>%
filter(Site != "CE_0")
# Adapt Trigger Level so that it goes in the right direction
Activity_file$TriggerLevel_adjusted = Activity_file$TriggerLevel
Activity_file$TriggerLevel_adjusted = ifelse(Activity_file$Recorder!="Audiomoth",-Activity_file$TriggerLevel, Activity_file$TriggerLevel_adjusted)
Activity_file$TriggerLevel_adjusted = ifelse(Activity_file$Recorder=="Audiomoth" & Activity_file$TriggerLevel==0, 100, Activity_file$TriggerLevel_adjusted)
Activity_file$TriggerLevel_adjusted = ifelse(Activity_file$Recorder=="Audiomoth" & Activity_file$TriggerLevel==5, 26, Activity_file$TriggerLevel_adjusted)
# Create short names
Activity_file$TriggerLevel_Short = Activity_file$TriggerLevel_adjusted
Activity_file$TriggerLevel_Short = ifelse(Activity_file$TriggerLevel_adjusted==0, "High", Activity_file$TriggerLevel_Short)
Activity_file$TriggerLevel_Short = ifelse(Activity_file$TriggerLevel_adjusted==-24, "Low", Activity_file$TriggerLevel_Short)
Activity_file$TriggerLevel_Short = ifelse(Activity_file$TriggerLevel_adjusted==-10, "Low", Activity_file$TriggerLevel_Short)
Activity_file$TriggerLevel_Short = ifelse(Activity_file$TriggerLevel_adjusted==26, "Low", Activity_file$TriggerLevel_Short)
Activity_file$TriggerLevel_Short = ifelse(Activity_file$TriggerLevel_adjusted==27, "Medium", Activity_file$TriggerLevel_Short)
Activity_file$TriggerLevel_Short = ifelse(Activity_file$TriggerLevel_adjusted==100, "High", Activity_file$TriggerLevel_Short)
# Add ID for Recorder + Sensitivity Level
Activity_file$ID = paste0(Activity_file$Recorder, "_", Activity_file$TriggerLevel_Short)
# Calculate insect and noise and other bat activity
List_bats_0s = c("Barbar", "Eptnil", "Eptser", "Hypsav", "Minsch", "Myoalc", "Myobec", "Myobly",
"Myobra", "Myocap", "Myodas", "Myodau", "Myoema", "MyoGT", "Myomyo", "Myomys",
"Myonat", "Myopun", "MyospA", "Nyclas", "Nyclei", "Nycnoc", "Pipkuh", "Pipnat",
"Pippip", "Pippyg", "Pleaur", "Pleaus", "Plemac", "Rhieur", "Rhifer", "Rhihip",
"Tadten", "Vesmur")
List_bats_0s = List_bats_0s[! List_bats_0s %in% Sp_select] # Removes focus species
List_bats_0s = paste0(List_bats_0s, "_0s")
Activity_non_target = Non_target_activity_file %>%
filter(probability_filter == Proba) %>%
group_by(DateNight, idparticipation) %>%
summarise(nb_triggered_files_insects = sum(nb_triggered_files[espece == "Insect_0s"]),
nb_triggered_files_noise = sum(nb_triggered_files[espece == "Noise_0s"]),
nb_triggered_files_bats = sum(nb_triggered_files[espece %in% List_bats_0s]))
# Calculate Relative activity to make results comparable
# Select species and keep only 0.5 confidence
Activity_file_for_model <- Activity_file %>%
filter(espece == Sp_select, probability_filter == Proba) %>%
group_by(DateNight) %>%
mutate(sm4bat_0_activity = nb_triggered_files[ID == "SM4BAT_High"]) %>%
mutate(Relative_activity = nb_triggered_files / sm4bat_0_activity) %>%
mutate(Relative_activity = ifelse(sm4bat_0_activity==0, NA, Relative_activity)) %>% #if SM4BAT_0 did not pick the species, then the species is considered absent on the site
ungroup() %>%
as.data.frame()
# Confirm this decision with Christian!!!
# Put Relative activity at 1 even if it is above 1
Activity_file_for_model$Relative_activity = ifelse(Activity_file_for_model$Relative_activity>1,
1,
Activity_file_for_model$Relative_activity)
# Add insect + noise + bat activity
Activity_file_for_model = Activity_file_for_model %>%
left_join(Activity_non_target) %>%
group_by(DateNight) %>%
mutate(sm4bat_0_insect_activity = nb_triggered_files_insects[ID == "SM4BAT_High"],
sm4bat_0_noise_and_insect_activity = nb_triggered_files_insects[ID == "SM4BAT_High"] + nb_triggered_files_noise[ID == "SM4BAT_High"],
sm4bat_0_noise_insect_bat_activity = nb_triggered_files_insects[ID == "SM4BAT_High"] + nb_triggered_files_noise[ID == "SM4BAT_High"] + nb_triggered_files_bats[ID == "SM4BAT_High"]) %>%
ungroup() %>%
as.data.frame()
Activity_file_for_model$Recorder = as.factor(Activity_file_for_model$Recorder)
Activity_file_for_model$ID = as.factor(Activity_file_for_model$ID)
Activity_file_for_model$TriggerLevel_adjusted = as.factor(Activity_file_for_model$TriggerLevel_adjusted)
#mycol <- c("Audiomoth"= "#E69F00","Batcorder"="#56B4E9","Batlogger"="#009E73","SM4BAT"="#D55E00")
# #### DATA VISUALISATION ####
#
# setwd("/home/charlotte/Documents/Post-Doc/Stages/Laureen et Nathan/Analyse/Exploration")
# png(filename=paste(Sp_select,"_", "Material",sep=""), height=700, width=1000,res=150)
#
# plot1 = ggplot(Activity_file_for_model, aes(x = Recorder, y = nb_triggered_files)) +
#   geom_boxplot(aes(fill = TriggerLevel_Short), color = "grey25", linewidth = 0.5, coef = 1.5) +
#   theme_minimal()
#
# print(plot1)
# dev.off()
#
# png(filename=paste(Sp_select,"_", "Material_and_Vegetation.png",sep=""), height=700, width=1000,res=150)
#
# plot2 = ggplot(Activity_file_for_model, aes(x = Distance_vegetation, y = nb_triggered_files, group=ID)) +
#   geom_rug() +
#   geom_smooth(aes(color = ID)) +
#   theme_minimal()
#
# print(plot2)
# dev.off()
#
# png(filename=paste(Sp_select,"_", "Material_and_non-target.png",sep=""), height=700, width=1000,res=150)
#
# plot3 = ggplot(Activity_file_for_model, aes(x = sm4bat_0_noise_insect_bat_activity, y = nb_triggered_files, group=ID)) +
#   geom_rug() +
#   geom_smooth(aes(color = ID)) +
#   theme_minimal()
#
# print(plot3)
# dev.off()
#### MODEL ENVIRONMENT EFFECT ####
# Question: how to account for the distance to vegetation (DV), and for the insect/noise activity (IA)?
# i.e. is there an interaction between recorder sensitivity and DV or IA?
# # Comment to keep the Audiomoths
# Activity_file_for_model = Activity_file_for_model %>%
#   filter(Recorder != "Audiomoth") %>%
#   droplevels()
# Activity
# NULL Model
glm1 <- glmmTMB(nb_triggered_files~ID +
(1|Site),
data = Activity_file_for_model, family = nbinom2)
# interaction with distance to vegetation:
glm2 = glmmTMB(nb_triggered_files ~ Distance_vegetation * ID +
(1|Site),
data=Activity_file_for_model, family = nbinom2)
# # interaction with distance to vegetation as a quadratic effect :
glm3 = glmmTMB(nb_triggered_files ~ Distance_vegetation * ID +
I(Distance_vegetation^2) * ID +
(1|Site),
data=Activity_file_for_model, family = nbinom2)
pr1 = predict_response(glm3, terms = c("Distance_vegetation", "ID"), bias_correction = TRUE)
ggplot(pr1, aes(x = x, y = predicted, colour = group)) +
geom_line(linewidth = 1) +
geom_ribbon(aes(ymin = conf.low, ymax = conf.high, fill = group), alpha = 0.2, color = NA) +
labs(y = paste0("Number of triggered recordings with ", Sp_select),
x = "Distance to vegetation (m)",
color = "", fill = "") +
scale_y_log10() +
theme_minimal()
pr1 = predict_response(glm2, terms = c("Distance_vegetation", "ID"), bias_correction = TRUE)
ggplot(pr1, aes(x = x, y = predicted, colour = group)) +
geom_line(linewidth = 1) +
geom_ribbon(aes(ymin = conf.low, ymax = conf.high, fill = group), alpha = 0.2, color = NA) +
labs(y = paste0("Number of triggered recordings with ", Sp_select),
x = "Distance to vegetation (m)",
color = "", fill = "") +
scale_y_log10() +
theme_minimal()
Non_target_activity_file %>%
ggplot(aes(x=Site, y=nb_triggered_files)) +
geom_boxplot()
names(Non_target_activity_file)
head(Non_target_activity_file)
table(Non_target_activity_file$espece)
head(Activity_non_target)
head(Activity_file_for_model)
Activity_file_for_model %>%
filter(espece=="Pippip") %>%
ggplot(aes(x=DateNight, y=sm4bat_0_noise_insect_bat_activity)) +
geom_point()
head(Activity_file_for_model %>%
filter(espece=="Pippip"))
Activity_file_for_model %>%
filter(espece=="Pippyg") %>%
ggplot(aes(x=DateNight, y=sm4bat_0_noise_insect_bat_activity)) +
geom_point()
